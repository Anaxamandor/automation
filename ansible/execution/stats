# unreachable

Ansible provides a magic variable called unreachable that can be used to retrieve the number of hosts that were unreachable during playbook execution. 
This variable is a dictionary that contains information about the unreachable hosts, such as the hostname and the reason for the failure.

To retrieve the number of unreachable hosts, you can use the length filter to count the number of items in the unreachable dictionary:



- name: Playbook example
  hosts: all
  tasks:
    # Your tasks here

  # Print the number of unreachable hosts
  post_tasks:
    - name: Print unreachable hosts
      debug:
        msg: "Number of unreachable hosts: {{ unreachable | length }}"
        
        
 Note that this variable only includes hosts that were marked as unreachable during the playbook execution. 
 It does not include hosts that failed for other reasons, such as a failed task or a syntax error in the playbook.
 
 #######################################################################################################################################
 
 # print out the total number of hosts in the inventory file that the playbook was run against:
 
 - name: Playbook example
  hosts: all
  tasks:
    # Your tasks here

  # Print the total number of hosts in the inventory file
  post_tasks:
    - name: Print total number of hosts
      debug:
        msg: "Total number of hosts in inventory file: {{ groups['all'] | length }}"


############################################################################################################################################

# stats module:

To determine how many hosts in the inventory file the play ran against successfully, you can use the stats module in Ansible. 
The stats module collects statistics about the hosts that were contacted during playbook execution, including whether the host was successful, 
failed, or unreachable.

You can use the stats module to collect statistics about the hosts, and then use the success attribute to get the number of hosts that were successful:

- name: Playbook example
  hosts: all
  tasks:
    # Your tasks here

  # Collect statistics and print the success rate
  post_tasks:
    - name: Collect statistics
      stat:
        task_path: "{{ item }}"
      loop: "{{ ansible_playbook_all_tasks }}"
      run_once: true

    - name: Print success rate
      debug:
        msg: "Success rate: {{ ansible_playbook_statistics.successful | default(0) }} / {{ groups['all'] | length }} ({{ ((ansible_playbook_statistics.successful | default(0)) / groups['all'] | length) * 100 }}%)"

    - name: Print success rate (multiline format)
      debug:
        msg: |
         Success rate:
           Number of successful hosts: {{ ansible_playbook_statistics.successful | default(0) }}
           Total number of hosts: {{ groups['all'] | length }}
           Percentage of successful hosts: {{ ((ansible_playbook_statistics.successful | default(0)) / groups['all'] | length) * 100 | round(2) }}%

 
This will print out the number of hosts that were successful, the total number of hosts in the inventory file, and the percentage of hosts that were successful.

Note that the ansible_playbook_statistics variable is only available after the playbook has completed. 

If you want to collect statistics during playbook execution, you can use the async module to run tasks in the background and collect statistics at regular intervals.

The Collect statistics task uses the stat module to collect statistics about each task in the playbook. 
It uses the loop syntax to iterate over the ansible_playbook_all_tasks variable, which is a list of all the tasks in the playbook.

The Print success rate task prints out the number of hosts that were successful, the total number of hosts in the inventory file, 
and the percentage of hosts that were successful. 

It uses the ansible_playbook_statistics.successful attribute to get the number of successful hosts, 
the default(0) filter to handle cases where there were no successful hosts, 
and the length filter to get the total number of hosts in the inventory file. 

The percentage is calculated by dividing the number of successful hosts by the total number of hosts and multiplying by 100.


